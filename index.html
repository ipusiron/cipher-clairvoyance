<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cipher Clairvoyance — 暗号解析ツール</title>
  <meta name="description" content="Cipher Clairvoyance: 古典暗号の方式を自動判定する教育用ツール">
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="container header">
    <div class="hero">
      <h1>🔮 Cipher Clairvoyance <span class="badge">Day044</span></h1>
      <p class="subtitle">暗号文を入力すると、使われた暗号方式を自動判定します</p>
    </div>
  </header>

  <main class="container">
    <!-- 入力エリア -->
    <section class="card">
      <div class="input-header">
        <h2>① 暗号文を入力</h2>
        <button id="btnSampleSelect" class="btn secondary sample-btn">📄 サンプル読み込み</button>
      </div>
      <textarea id="cipherText" rows="6" placeholder="解析したい暗号文を入力してください（英語のみ対応）"></textarea>
      
      <!-- オプション設定 -->
      <details class="options-detail">
        <summary>⚙️ 詳細設定</summary>
        <div class="options-content">
          <h4>前処理</h4>
          <div class="checks">
            <label><input type="checkbox" id="chkStripNonLetters" checked> 英字以外を除外して解析</label>
            <label><input type="checkbox" id="chkPreserveSpaces" checked> スペースは表示用に保持</label>
          </div>
          
          <h4>解析手法</h4>
          <div class="checks">
            <label><input type="checkbox" id="chkBasic" checked> 基本統計</label>
            <label><input type="checkbox" id="chkCaesarAffine" checked> Caesar/Affine総当り</label>
            <label><input type="checkbox" id="chkVigAutoKasiski" checked> Vigenère周期検出</label>
            <label><input type="checkbox" id="chkVigColumns" checked> Vigenère列分析</label>
            <label><input type="checkbox" id="chkPlayfair" checked> Playfair検出</label>
            <label><input type="checkbox" id="chkTransposition" checked> 転置暗号検出</label>
            <label><input type="checkbox" id="chkADFGX" checked> ADFGX(VX)検出</label>
          </div>
        </div>
      </details>
      
      <div class="action-area">
        <button id="btnAnalyze" class="btn primary large" disabled>🔍 解析開始</button>
        <button id="btnClear" class="btn" disabled>クリア</button>
      </div>
    </section>

    <!-- メイン結果 -->
    <section id="mainResult" class="card result-card hidden">
      <h2>② 解析結果</h2>
      
      <!-- シンプルな結果表示 -->
      <div id="simpleResult" class="simple-result">
        <div class="winner-cipher">
          <div class="cipher-icon">🏆</div>
          <div class="cipher-details">
            <h3 id="winnerName">判定中...</h3>
            <p id="winnerDesc" class="description"></p>
            <div class="confidence-bar">
              <div id="confidenceLevel" class="confidence-fill"></div>
              <span id="confidenceText" class="confidence-text">0%</span>
            </div>
          </div>
        </div>
        
        <div class="other-possibilities" id="otherPossibilities"></div>
      </div>

      <!-- 判定根拠 -->
      <div class="evidence-section">
        <h3>🔍 判定根拠</h3>
        <div id="evidenceContent" class="evidence-content">
          <!-- 根拠はJSで動的生成 -->
        </div>
      </div>

      <!-- 詳細表示トグル -->
      <div class="detail-toggle">
        <button id="toggleDetails" class="btn secondary">📊 詳細な分析を見る</button>
      </div>
    </section>

    <!-- 詳細分析（初期は非表示） -->
    <section id="detailsSection" class="hidden">
      <!-- 基本統計 -->
      <div class="card detail-card">
        <h3>
          <span class="help-icon" title="暗号文の基本的な統計情報">ℹ️</span>
          基本統計
        </h3>
        <div id="basicStats" class="stats-grid"></div>
        
        <!-- 文字頻度グラフ -->
        <div class="freq-chart-container">
          <h4>文字の出現頻度</h4>
          <p class="help-text">青: 暗号文の頻度 / 灰: 英語の標準頻度</p>
          <svg id="freqChart" class="freq-chart" viewBox="0 0 520 180"></svg>
        </div>
      </div>

      <!-- 高度な分析（初期は非表示） -->
      <div id="advancedSection" class="hidden">
        <!-- 周期性分析 -->
        <div class="card detail-card">
          <h3>
            <span class="help-icon" title="Vigenère暗号などの周期性を持つ暗号を検出する分析手法">ℹ️</span>
            周期性分析（Vigenère暗号の検出）
          </h3>
          
          <div style="margin-bottom: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 3px solid #3b82f6;">
            <h4 style="margin: 0 0 0.5rem 0; color: #1e293b;">なぜ周期性を調べるのか？</h4>
            <p style="margin: 0; color: #64748b; line-height: 1.5;">
              Vigenère暗号は「CIPHER」のようなキーワードを繰り返し使って暗号化します。
              キーワードが繰り返されるため、暗号文にも規則的なパターンが現れます。
              この「周期性」を見つけることで、Vigenère暗号であることや鍵の長さを推定できます。
            </p>
          </div>
          
          <div class="period-analysis">
            <div class="analysis-item">
              <h4>自己相関分析</h4>
              <div style="margin-bottom: 1rem;">
                <p class="help-text" style="margin-bottom: 0.5rem;"><strong>何をしているか：</strong></p>
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">
                  暗号文を少しずつずらして、元の文字と一致する割合を計算します。
                  Vigenère暗号では、鍵の長さの倍数でずらしたときに一致率が高くなります。
                </p>
                <p class="help-text"><strong>グラフの見方：</strong> 高い棒グラフが現れる位置が鍵長の手がかり</p>
              </div>
              <svg id="acSpark" class="mini-chart" viewBox="0 0 400 60"></svg>
            </div>
            
            <div class="analysis-item">
              <h4>Kasiski分析</h4>
              <div style="margin-bottom: 1rem;">
                <p class="help-text" style="margin-bottom: 0.5rem;"><strong>何をしているか：</strong></p>
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 0.5rem;">
                  暗号文の中で同じ文字列が繰り返し現れる箇所を探し、その間隔を調べます。
                  Vigenère暗号では、これらの間隔が鍵の長さの倍数になる傾向があります。
                </p>
                <p class="help-text"><strong>グラフの見方：</strong> よく現れる間隔が鍵長の候補</p>
              </div>
              <svg id="gcdSpark" class="mini-chart" viewBox="0 0 400 60"></svg>
            </div>
          </div>
          
          <div style="margin-top: 1rem; padding: 1rem; background: #fff7ed; border-radius: 8px; border-left: 3px solid #f59e0b;">
            <h4 style="margin: 0 0 0.5rem 0; color: #92400e;">💡 分析結果の読み方</h4>
            <ul style="margin: 0; padding-left: 1.2rem; color: #92400e; font-size: 0.9rem;">
              <li style="margin-bottom: 0.25rem;">両方のグラフで同じ数値（例：6, 12, 18など）に高い値が出る場合、その数値が鍵長の可能性が高い</li>
              <li style="margin-bottom: 0.25rem;">単発暗号（Caesar、Affineなど）では明確なピークは現れません</li>
              <li>ランダムなテキストでも偶然のピークが出ることがあります</li>
            </ul>
          </div>
          
          <div id="vigDetails" class="vig-details hidden">
            <h4>推定された鍵長での列分析</h4>
            <div id="vigColumns" class="vig-columns"></div>
          </div>
        </div>

        <!-- 繰り返しパターン -->
        <div class="card detail-card">
          <h3>
            <span class="help-icon" title="暗号文中の繰り返しパターン">ℹ️</span>
            繰り返しパターン分析
          </h3>
          <div id="repeats" class="repeats-table"></div>
        </div>
      </div>

      <!-- 専門家向け表示トグル -->
      <div class="card">
        <button id="toggleAdvanced" class="btn secondary">🔬 専門家向け分析を見る</button>
      </div>
    </section>

  </main>

  <footer>
    <div class="footer">
      🔗 GitHubリポジトリはこちら（ <a href="https://github.com/ipusiron/cipher-clairvoyance" target="_blank">ipusiron/cipher-clairvoyance</a> ）
    </div>
  </footer>

  <!-- サンプル選択モーダル -->
  <div id="sampleModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>📄 サンプル暗号文を選択</h3>
        <button id="modalClose" class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-description">
          各暗号方式のサンプル暗号文から選択してください。<br>
          アメリカ独立宣言の一部を各種暗号で暗号化したものです。
        </p>
        <div id="sampleList" class="sample-list">
          <!-- サンプルリストはJSで動的生成 -->
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript モジュール -->
  <script type="module" src="js/app.js"></script>
</body>
</html>